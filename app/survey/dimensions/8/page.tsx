"use client";import { useState, useEffect } from "react";import { hasAnyOffered } from '@/lib/dimensionHelpers';import { useRouter } from "next/navigation";import Header from "@/components/Header";import Footer from "@/components/Footer";// Fisher-Yates shuffle algorithmfunction shuffleArray<T>(array: T[]): T[] { const shuffled = [...array]; for (let i = shuffled.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]]; } return shuffled;}const D8A_ITEMS_BASE = [ "Flexible work arrangements during treatment", "Phased return-to-work plans", "Workload adjustments during treatment", "Flexibility for medical setbacks", "Buddy / mentor pairing for support", "Structured progress reviews", "Contingency planning for treatment schedules", "Long-term success tracking", "Access to occupational therapy / vocational rehabilitation", "Online peer support forums", "Access to specialized work resumption professionals", "Manager training on supporting team members during treatment / return"];export default function Dimension8Page() { const router = useRouter(); const [step, setStep] = useState(0); const [ans, setAns] = useState<any>({}); const [errors, setErrors] = useState<string>(""); const [currentItemIndex, setCurrentItemIndex] = useState(0); const [isMultiCountry, setIsMultiCountry] = useState(false); const [isTransitioning, setIsTransitioning] = useState(false);  const [D8A_ITEMS] = useState(() => shuffleArray(D8A_ITEMS_BASE)); useEffect(() => { const saved = localStorage.getItem("dimension8_data"); if (saved) { try { const parsed = JSON.parse(saved); setAns(parsed); } catch (e) { console.error("Error loading saved data:", e); const firmographicsData = localStorage.getItem("firmographics_data"); if (firmographicsData) { const parsed = JSON.parse(firmographicsData); setIsMultiCountry(parsed.s9a !== "No other countries - headquarters only"); }, []); if (Object.keys(ans).length > 0) { localStorage.setItem("dimension8_data", JSON.stringify(ans)); }, [ans]); if (step !== 1) { window.scrollTo({ top: 0, behavior: 'smooth' }); }, [step]); const setField = (key: string, value: any) => { setAns((prev: any) => ({ ...prev, [key]: value })); setErrors(""); }; const setStatus = (item: string, status: string) => { setAns((prev: any) => ({ ...prev, d8a: { ...(prev.d8a || {}), [item]: status } })); setIsTransitioning(true); setTimeout(() => { const nextUnansweredIndex = D8A_ITEMS.findIndex((itm, idx) =>  idx > currentItemIndex && !ans.d8a?.[itm] ); if (nextUnansweredIndex !== -1) { setCurrentItemIndex(nextUnansweredIndex); } else if (currentItemIndex < D8A_ITEMS.length - 1) { setCurrentItemIndex(currentItemIndex + 1); setIsTransitioning(false); }, 250); }, 500); const goToItem = (index: number) => { setCurrentItemIndex(index); }, 400); const STATUS_OPTIONS = [ "Not able to offer in foreseeable future", "Assessing feasibility", "In active planning / development", "Currently offer" ]; const hasAnyOffered = Object.values(ans.d8a || {}).some( (status) => status === "Currently offer" const showD8aa = isMultiCountry && hasOffered; const getTotalSteps = () => { let total = 4; // intro, D8.a, D8.aa (conditional), D8.b total++; // completion return total; const validateStep = () => { switch(step) { case 1: const answeredCount = Object.keys(ans.d8a || {}).length; if (answeredCount < D8A_ITEMS.length)  return `Please evaluate all ${D8A_ITEMS.length} items (${answeredCount} completed)`; return null; case 2: if (showD8aa && !ans.d8aa) { return "Please select one option"; case 3: default: const next = () => { const error = validateStep(); if (error) { setErrors(error); return; if (step === 1) { if (showD8aa) { setStep(2); } else { setStep(3); } else if (step === 2) { } else if (step === 3) { setStep(4); // Go to completion } else if (step === 4) { localStorage.setItem("dimension8_complete", "true"); router.push("/dashboard"); const back = () => { if (step === 4) { setStep(showD8aa ? 2 : 1); setStep(1); } else if (step > 0) { setStep(step - 1); return ( <div className="min-h-screen bg-gray-50 flex flex-col"> <Header /> <main className="flex-1 max-w-5xl mx-auto px-4 py-8"> <div className="mb-6"> <div className="flex items-center justify-between mb-2"> <span className="text-sm text-gray-600"> Dimension 8: Work Continuation & Resumption </span> </div> <div className="w-full bg-gray-200 rounded-full h-2"> <div  className="bg-gradient-to-r from-orange-500 to-orange-600 h-2 rounded-full transition-all" style={{ width: `${(step / getTotalSteps()) * 100}%` }} /> {errors && ( <div className="mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm"> {errors} )} {/* Step 0: Introduction */} {step === 0 && ( <div className="bg-white rounded-xl shadow-sm p-8"> <div className="max-w-3xl mx-auto"> <p className="text-lg text-gray-700 mb-6"> Here is the next aspect of support programs for{" "} <strong>employees managing cancer or other serious health conditions</strong>: </p> <div className="bg-gradient-to-r from-blue-600 to-blue-700 p-6 rounded-xl mb-8"> <h2 className="text-3xl font-bold text-white mb-3">WORK CONTINUATION & RESUMPTION</h2> <p className="text-blue-100 text-lg mb-4"> Structured, supportive processes for helping employees: <ul className="text-blue-100 space-y-1 ml-4"> <li>â€¢ Continue working during treatment and recovery</li> <li>â€¢ Resume work after medical leave</li> <li>â€¢ Manage ongoing treatment needs while working</li> <li>â€¢ Navigate the physical and cognitive impacts of treatment</li> </ul> <div className="bg-gray-50 p-6 rounded-lg border border-gray-200"> <h3 className="font-semibold text-gray-900 mb-4">How this assessment works:</h3> <ul className="space-y-3 text-gray-700"> <li className="flex items-start"> <span className="text-blue-600 mr-2 mt-1">â€¢</span> <span>You'll see different support options associated with this dimension, one at a time</span> </li> <span><strong>Indicate the current status of each option within your organization</strong></span> <span>After selecting a response, it will automatically advance to the next option</span> <span>Use the navigation dots or arrows to review or change any response</span> <span>Once all support options are evaluated, the Continue button will appear</span> <div className="flex justify-center mt-8"> <button onClick={() => setStep(1)} className="px-8 py-3 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-lg font-semibold hover:shadow-lg transition-all text-lg" > Begin Assessment </button> {/* Step 1: D8.a Progressive Cards */} {step === 1 && ( <div className="bg-white rounded-xl shadow-sm"> <div className="bg-gradient-to-r from-gray-900 to-gray-800 px-8 py-6 rounded-t-xl"> <div className="flex justify-between items-start"> <div className="flex-1"> <h2 className="text-2xl font-bold text-white mb-2">WORK CONTINUATION & RESUMPTION</h2> <p className="text-gray-300 text-sm"> Supporting employees during treatment and return to work <div className="p-8"> <div className="flex items-center justify-between"> <span className="text-lg font-bold text-gray-800"> Item {currentItemIndex + 1} of {D8A_ITEMS.length} <div className="flex gap-1"> {D8A_ITEMS.map((item, idx) => ( key={idx} onClick={() => goToItem(idx)} className={`h-2 transition-all duration-500 rounded-full ${ ans.d8a?.[item] ? "w-8 bg-green-600 hover:bg-green-700 cursor-pointer" : idx === currentItemIndex ? "w-8 bg-blue-600" : "w-2 bg-gray-300 hover:bg-gray-400 cursor-pointer" }`} title={item} disabled={isTransitioning} ))} <div className={`bg-gradient-to-br from-blue-50 via-white to-blue-50 p-8 rounded-xl border-2 border-blue-100 transition-all duration-700 ease-in-out ${ isTransitioning ? 'opacity-0 transform scale-95 blur-sm' : 'opacity-100 transform scale-100 blur-0' <h3 className="text-lg font-semibold text-gray-900 mb-2"> {D8A_ITEMS[currentItemIndex]} </h3> <p className="text-xs italic text-gray-600 mb-4"> We recognize that implementation may vary based on country / jurisdiction-specific laws and regulations. <div className="space-y-2"> {STATUS_OPTIONS.map((status) => ( key={status} onClick={() => setStatus(D8A_ITEMS[currentItemIndex], status)} className={`w-full p-4 text-left rounded-lg border-2 transition-all transform ${ ? 'cursor-not-allowed opacity-50' : 'hover:scale-[1.02] cursor-pointer' } ${ ans.d8a?.[D8A_ITEMS[currentItemIndex]] === status ? "border-blue-500 bg-blue-50 shadow-lg" : "border-gray-200 hover:border-gray-300 bg-white hover:shadow" <div className="flex items-center"> <div className={`w-5 h-5 rounded-full border-2 mr-3 transition-all ${ ? "border-blue-500 bg-blue-500" : "border-gray-300 bg-white" }`}> {ans.d8a?.[D8A_ITEMS[currentItemIndex]] === status && ( <div className="w-full h-full flex items-center justify-center"> <div className="w-2 h-2 bg-white rounded-full" /> <span className="text-base">{status}</span> <div className="flex justify-between items-center mt-6"> onClick={() => goToItem(Math.max(0, currentItemIndex - 1))} disabled={currentItemIndex === 0 || isTransitioning} className={`px-4 py-2 text-sm font-medium transition-all ${ currentItemIndex === 0 || isTransitioning ? "text-gray-300 cursor-not-allowed" : "text-gray-600 hover:text-gray-800" â† View previous option {Object.keys(ans.d8a || {}).length === D8A_ITEMS.length && !isTransitioning && ( onClick={next} className="px-8 py-3 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-lg font-semibold hover:shadow-lg transition-shadow animate-pulse" Continue â†’ {/* Step 2: D8.aa (conditional for multi-country) */} {step === 2 && showD8aa && ( <div className="bg-white p-6 rounded-lg shadow-sm"> <h3 className="text-xl font-bold text-gray-900 mb-4">Geographic Availability</h3> <p className="font-bold text-gray-900 mb-4"> Are the <span className="text-blue-600 font-bold">Work Continuation & Resumption support options</span> your  organization <span className="text-blue-600 font-bold">currently offers</span>...? <p className="text-sm text-gray-600 mb-4">(Select ONE)</p> {[ "Only available in select locations", "Vary across locations",  "Generally consistent across all locations" ].map(opt => ( key={opt} onClick={() => setField("d8aa", opt)} className={`w-full px-4 py-3 text-left text-sm md:text-base rounded-lg border-2 transition-all ${ ans.d8aa === opt ? "border-blue-500 bg-blue-50" : "border-gray-200 hover:border-gray-300" {opt} {/* Step 3: D8.b open-end */} {step === 3 && ( <h3 className="text-xl font-bold text-gray-900 mb-4">Additional Supports</h3> What other <span className="text-blue-600 font-bold">work continuation or resumption supports</span> does your organization offer at any location that weren't listed? <p className="text-sm text-gray-600 mb-4">(Please be as specific and detailed as possible)</p> <textarea value={ans.d8b || ""} onChange={(e) => setField("d8b", e.target.value)} className="w-full min-h-[120px] px-4 py-3 border-2 border-gray-300 rounded-lg" placeholder="Describe any additional supports..." <label className="flex items-center mt-3"> <input type="checkbox" checked={ans.d8b_none || false} onChange={(e) => { setField("d8b_none", e.target.checked); if (e.target.checked) setField("d8b", ""); }} className="w-4 h-4 mr-2" <span className="text-sm">No other supports</span> </label> {/* Step 4: Completion */} {step === 4 && ( <div className="bg-white p-8 rounded-lg shadow-sm text-center"> <svg className="w-16 h-16 mx-auto text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"> <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /> </svg> <h2 className="text-2xl font-bold text-gray-900 mb-3"> Dimension 8 Complete! </h2> <p className="text-gray-600 mb-8"> You've successfully completed the Work Continuation & Resumption dimension. onClick={() => {  localStorage.setItem("dimension8_complete", "true");  router.push("/dashboard");  className="px-10 py-4 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-lg font-semibold hover:shadow-lg transition-shadow" Save & Return to Dashboard â†’ {/* Universal Navigation */} {step > 1 && step < 4 && ( <div className="flex justify-between mt-8"> <button  onClick={back}  className="px-6 py-2 border-2 border-gray-300 rounded-lg hover:bg-gray-50 font-medium" â† Back onClick={next}  className="px-8 py-3 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-lg font-semibold hover:shadow-lg transition-shadow" </main> <Footer />
